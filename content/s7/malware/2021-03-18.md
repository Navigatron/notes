---
date: 2021-03-18
title: "Regex, Snort Rules, and Midterm Prep"
---

[Index](../../../index.md) > [Course](./index.md) > {{ page.date }}: {{ page.title }}

# {{ page.date }}: {{ page.title }}

- Finish the Chapter!
- Do some lab work

## Regex

- Regular characters match regular characters
    - `guacamole` matches `guacamole`, what do you expect lol
- `()` is a *Capture Group*
    - We can match a capture group multiple times with `{}`
    - `(){4}` matches 4 of the group
    - `(){2,6}` matches 2, 3, 4, 5, or 6 of the group
- `[]` is a *Character Set*
    - `[0-9]` matches any single-digit number
    - Repetition works here too!
    - `[0-9A-Fa-f]{6}` matches any 6-digit hex number (like colors!)
- `|` is an *or* operator

### Performance

In last class's example, we're looking for two 58's (ascii for `:`). We match these in the regex. But, we don't want to run the regex matcher if we don't have to, so we *also* match the 58's in the snort rule.

If there aren't two 58's between 6 and 9 bytes apart, then we don't run the regex matcher at all.

## Back to the malware

Looking at the malware from last class - After it makes its web request, the returned HTML contains a comment like:

```
<!-- adsrv?abcdefgh -->
```

Running strings on the binary, we find `adsrv?` again. How does the malware check for this string in the html?

1. Find `<!--`
2. Make sure it is followed by `adsrv?`
2. Consume characters, until we find `-->`
2. Return the consumed characters as the command string.

This malware could take 5 commands:

- sleep for 1 minute
- sleep for 1 hour
- sleep for 24 hours
- Download and run an executable
- Connect for a reverse shell

## Target multiple components

If we can make two separate rules for different parts of the traffic, you should! That way, if one component changes, the other might still be valid.

Think about which parts of the communication are hardest for the attacker to change.

## Midterm!

- Duration: 1 week
    - Opens at 12:01 AM on Sunday the 21st
    - Closes at 11:59PM on Saturday the 27th

There are 33 questions. Multiple choice, true/false, category.

One page of notes is allowed, though it must be uploaded via photo at the end of the exam.

> "The answers are abcdtf" - Prof.

Know these terms:

- Downloaders vs Launchers
- Backdoors
- Reverse Shells
- RATs

Know the differences:

- Process Injection
- Process Replacement
- DLL Injection
- DLL Replacement?

Know why a binary might want to do these things.

Be familiar with what these do:

- winlogon exe
- appinit dll
- user32 dll
- service host exe
- lsass exe

Difference between:

- Local Hooks
- Remote Hooks

Be familiar with:

- XOR
    - clearing registers
    - cryptography
    - zero-preserving cryptography
- low-level vs multi-threaded reverse shells
- Differences between (import address table) IAT hooking and inline hooking
- Detours?
    - It's a microsoft library for editing binaries
- Trampolines
- Base64
- How entropy can identify cryptography
- The ways attackers achieve persistence
- Keyloggers
    - Polling vs Hooking
    - How they work
- Cryptographic Constants
- Botnets, Trojan Horses, **crasher-stealers**
- Cryptographic Algorithms
    - Targeting Confidentiality vs Integrity require different techniques

## Lab 6

Pick 14-1, 14-2, or 14-3: whichever you like, that's it. Due on April 1st.

---

[Index](../../../index.md) > [Course](./index.md) > {{ page.date }}: {{ page.title }}
