---
date: 2021-03-30
title: "Polymorphism Demo"
---

[Index](../../../index.md) > [Malware](./index.md) > {{ page.date }}: {{ page.title }}

# {{ page.date }}: {{ page.title }}

The first few lines of a function are called the function *prologue*.

If something is being used as a pointer, it's probably a pointer.

## Create a Structure

1. Structures Tab
2. "insert" key
3. Name your Structure
4. click the structs name
    - `N` will re-name it
5. Click where it says `ends`
6. Hit `D` to add a field
7. Click the `db` of the new field
    - `D` toggles between `db`, `dw`, `dd` for byte, word, double
8. Click the field's name, use `N` to rename it

Writing to `[eax]`? That's the same as `[eax+0]`, which could be the first field of an object.

1. Right click `eax`
2. hover `structures`
    - IDA displays the possible structure offsets

## Our Example

Function 70 returned a pointer to an object, after setting its first field to a function pointer.

Function 30, which called 70, overwrites that field with a pointer to a slightly different function.

What we saw was roughly this:

```js
// field0 of our objects will point to a function.
// Base Class uses this one:
function add_two_numbers(obj){
    let eax = obj.field1 + obj.field2;
    return eax;
}

// Derived classes point to this one:
function mult_two_numbers(obj){
    let eax = obj.field1 * obj.field2;
    return eax;
}

// The base object gets a function pointer
function build_base(){
    let my_obj = {
        field0: add_two_numbers
    };
    return my_obj;
}

// Derive from Base, overwriting the function pointer
function build_derived_1(){
    let my_obj = build_base();
    my_obj.field0 = mult_two_numbers;
    return my_obj;
}

// Here's a setter!
function set_obj_fields(obj, val1, val2){
    obj.field1 = val1;
    obj.field2 = val2;
}

// Create our two objects
let obj1 = build_base();
let obj2 = build_derived_1();

// Load Values
set_obj_fields(obj1, 1, 2);
set_obj_fields(obj2, 3, 4);

// Now, do polymorphism
console.log(obj1.field0(obj1));
console.log(obj2.field0(obj2));
```

---

[Index](../../../index.md) > [Malware](./index.md) > {{ page.date }}: {{ page.title }}
