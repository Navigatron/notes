---
date: 2021-03-16
title: "That Snort rule, part 3: the glory of regex"
---

[Index](../../../index.md) > [Course](./index.md) > {{ page.date }}: {{ page.title }}

# {{ page.date }}: {{ page.title }}

Things are due *today*:

- Lab 3
- Lab 4
- Lab 5

## Depths of Analysis

Dynamic analysis is useful, and can generate some detection rules - but static analysis can reveal some extra things to build even better detection rules.

You can analyze malware at different depths:

- Surface Analysis
    - strings
    - redshot, searching for storage artifacts
    - The names of imported functions
- Communication method coverage
    - Understand the communications going on
    - Wireshark capture
- Operational replication
    - Able to emulate the malware for c2 outreach
- Code coverage
    - Understanding every block of code
    - But that will take forever
    - So just understand the important parts

## Attackers mimic existing protocols

HTTP and DNS are the most common protocols on the internet - so malware will use them too, to blend in. Try this DNS request:

```
www.thepasswordisflapjack.evil.com
```

The payload information is included as a subdomain, the evil dns server can easily extract the info.

> ICMP Payload is another popular exfil technique.

Advanced attackers use native syscalls to do communication, so that it's identical to valid traffic.

Responses can also be sneaky - embedding commands in html comments is a common technique.

## Other malware techniques

Construct a profile of the victim, either by encoding or hashing some finger-printable characteristics. Send this in the handshake, so the C2 infrastructure knows which victim it's talking too.

Malware on an onion site can extract a mac address from dhcp traffic - then, when the gov seizes the criminal's machines, they can correlate mac addresses to build a case.

> "The best way to use IDA Pro, is to go to strings, or to imports, find something interesting, and use CTRL+X to see the references." - Prof.



---

[Index](../../../index.md) > [Course](./index.md) > {{ page.date }}: {{ page.title }}
