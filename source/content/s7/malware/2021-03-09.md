---
date: 2021-03-09
title: "Analyzing undetected and Snorting pt 1"
---

[Index](../../../index.md) > [Course](./index.md) > {{ page.date }}: {{ page.title }}

# {{ page.date }}: {{ page.title }}

## MidTerm

As soon as Chapter 14 ends, historically class 15. This is class 12.

The class before the midterm will be review, and the midterm will be available for an *entire week*.

> An entire week! That's awesome. Thanks prof!

## Indirection Tactics

Sometimes, analyzing the malware can tip off the controller. This is bad - they could target you, or release v2 of the malware. Ideally, the malware author / controller doesn't know you're analyzing their malware.

### Use Different Internet

Without internet, you lose half the communication abilities of the malware. You want to use internet, just not your own.

Good ideas:

- Cell Connection
    - Hard (for the malware controllers) to geolocate
- VPN or SSH tunnel
    - Appear where you want to appear
    - Inside the targeted network,
    - or at least outside your house
- An ephemeral machine in a cloud
    - AWS / Azure

### Search Engines

If you google a domain that google wasn't previously aware of, google might go crawl it.

> Prof. says visiting a site via wayback machine still queries images from the real site; I doubt this

The `GetHostByName` function call initiates a DNS query. This is usually followed by `Connect`, which initiates a TCP handshake.

The American Registry for Internet Numbers (ARIN) holds the IP registry. DNS maps names to these IPs.

You can issue a DNS query - but there are online tools that can do it for you. Then the query comes from someone other than you. (Though *any* dns request can be an alert to the adversary.) Online tools can also reveal other metadata, like which other domains were registered at the same time, or geolocation data.

> But you can't trust geolocation data.

## SNORT

Snort is a popular IDS. Through rules and signatures, snort can generate alerts when something interesting is detected.

Generic snort format:

```
rule header (rule options)
```

An example rule:

```
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:"TROJAN Malicious User-Agent"; content:"|0d 0a|User-Agent\: Wefa7e"; classtype:trojan-activity; sid:2000001; rev:1;)
```

In generic form:

- Header
    - alert
        - Generate an alert when this rule matches
    - tcp
        - Match TCP traffic
    - $HOME_NET any
        - Source IP - the local network
        - Source Port - *any* port - the client initiating the connection could use any dynamic port.
    - $EXTERNAL_NET $HTTP_PORTS
        - Destination IP - some external network
        - Destination Port - HTTP / 80
- Options
    - msg
    - content
    - classtype
    - sid
    - rev

> Out of time - Options will be completed next class!

---

[Index](../../../index.md) > [Course](./index.md) > {{ page.date }}: {{ page.title }}
