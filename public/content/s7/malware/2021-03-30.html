<!DOCTYPE html>
<html lang=" en-US">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
	<!-- MathJax disabled on this page -->

		


		<!--[if lt IE 9]>
			<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
		<![endif]-->
		
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Arvo&family=Fira+Mono&family=Open+Sans&display=swap');
		</style>
		<link rel="stylesheet" href="/styles/index.css?v=1657689426783">

		<!-- Code Highlighting -->
		<link rel="stylesheet" href="https://raw.githubusercontent.com/PrismJS/prism-themes/master/themes/prism-one-light.css">
	</head>

	<body>
		<main>
			
			


<article>
	<p><a href="../../../">Index</a> &gt; <a href="./">Malware</a> &gt; Mon Mar 29 2021 20:00:00 GMT-0400 (Eastern Daylight Time):</p>
<h1>Mon Mar 29 2021 20:00:00 GMT-0400 (Eastern Daylight Time):</h1>
<p>The first few lines of a function are called the function <em>prologue</em>.</p>
<p>If something is being used as a pointer, it's probably a pointer.</p>
<h2>Create a Structure</h2>
<ol>
<li>Structures Tab</li>
<li>&quot;insert&quot; key</li>
<li>Name your Structure</li>
<li>click the structs name
<ul>
<li><code>N</code> will re-name it</li>
</ul>
</li>
<li>Click where it says <code>ends</code></li>
<li>Hit <code>D</code> to add a field</li>
<li>Click the <code>db</code> of the new field
<ul>
<li><code>D</code> toggles between <code>db</code>, <code>dw</code>, <code>dd</code> for byte, word, double</li>
</ul>
</li>
<li>Click the field's name, use <code>N</code> to rename it</li>
</ol>
<p>Writing to <code>[eax]</code>? That's the same as <code>[eax+0]</code>, which could be the first field of an object.</p>
<ol>
<li>Right click <code>eax</code></li>
<li>hover <code>structures</code>
<ul>
<li>IDA displays the possible structure offsets</li>
</ul>
</li>
</ol>
<h2>Our Example</h2>
<p>Function 70 returned a pointer to an object, after setting its first field to a function pointer.</p>
<p>Function 30, which called 70, overwrites that field with a pointer to a slightly different function.</p>
<p>What we saw was roughly this:</p>
<pre><code class="language-js">// field0 of our objects will point to a function.
// Base Class uses this one:
function add_two_numbers(obj){
    let eax = obj.field1 + obj.field2;
    return eax;
}

// Derived classes point to this one:
function mult_two_numbers(obj){
    let eax = obj.field1 * obj.field2;
    return eax;
}

// The base object gets a function pointer
function build_base(){
    let my_obj = {
        field0: add_two_numbers
    };
    return my_obj;
}

// Derive from Base, overwriting the function pointer
function build_derived_1(){
    let my_obj = build_base();
    my_obj.field0 = mult_two_numbers;
    return my_obj;
}

// Here's a setter!
function set_obj_fields(obj, val1, val2){
    obj.field1 = val1;
    obj.field2 = val2;
}

// Create our two objects
let obj1 = build_base();
let obj2 = build_derived_1();

// Load Values
set_obj_fields(obj1, 1, 2);
set_obj_fields(obj2, 3, 4);

// Now, do polymorphism
console.log(obj1.field0(obj1));
console.log(obj2.field0(obj2));
</code></pre>
<hr>
<p><a href="../../../">Index</a> &gt; <a href="./">Malware</a> &gt; Mon Mar 29 2021 20:00:00 GMT-0400 (Eastern Daylight Time):</p>

</article>
			
			<footer>
				<hr>
				<p>
					&copy; <a href="https://ewitherington.me">Ethan Witherington</a> 2022
				</p>
			</footer>
		</main>
	</body>

</html>