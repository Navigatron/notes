<!DOCTYPE html>
<html lang=" en-US">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
	<!-- MathJax disabled on this page -->

		


		<!--[if lt IE 9]>
			<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
		<![endif]-->
		
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Arvo&family=Fira+Mono&family=Open+Sans&display=swap');
		</style>
		<link rel="stylesheet" href="/styles/index.css?v=1657689426783">

		<!-- Code Highlighting -->
		<link rel="stylesheet" href="https://raw.githubusercontent.com/PrismJS/prism-themes/master/themes/prism-one-light.css">
	</head>

	<body>
		<main>
			
			


<article>
	<p><a href="../../../">Index</a> &gt; <a href="./">Malware</a> &gt; Mon Mar 22 2021 20:00:00 GMT-0400 (Eastern Daylight Time):</p>
<h1>Mon Mar 22 2021 20:00:00 GMT-0400 (Eastern Daylight Time):</h1>
<blockquote>
<p>Oh NO.
C++ and lack of sleep are my two fatal flaws.
This is gonna be <em>rough</em></p>
</blockquote>
<ul>
<li>IDA Features</li>
<li>Classes</li>
<li>Structures</li>
<li>VTables</li>
</ul>
<p><strong>Base Class</strong> - like a &quot;superclass&quot; in Java, other classes derive from this.</p>
<p><strong>Derived Class</strong> - like a &quot;subclass&quot; in Java, this <em>derives</em> from a base class.</p>
<p>A <strong>Vector</strong> is better than an array, because it is dynamically growable.</p>
<h2>The Space Object Example</h2>
<p>A <em>Space Object</em> is a <em>Base Class</em> with a <em>virtual function</em> called <code>Draw</code>.</p>
<blockquote>
<p>A virtual function is a function that <em>should</em> be overridden in the derived classes</p>
</blockquote>
<p>We have a <em>Vector</em> of Space Object pointers, and we call the draw function on each one.</p>
<p>But! These objects are all <em>Derived Classes</em>, and they have their own draw functions that are specific to them.</p>
<ul>
<li><code>Baseclass.function()</code> calls the base function directly</li>
<li><code>DerivedClass.function()</code> calls the derived function directly</li>
<li><code>BaseClassPointer-&gt;function()</code> calls the base function <em>virtually</em></li>
<li><code>DerivedClassPointer-&gt;function()</code> calls the derived function <em>virtually</em></li>
</ul>
<p><strong>IMPORTANT</strong>: The <code>BaseClassPointer</code> of <code>BaseClassPointer-&gt;function()</code> <em>might not be</em> a Base Class Pointer! That could be a derived class pointer, in a base class pointer box - and it can do that, since it derives from the base class. <code>Animal myAnimal = new Cow()</code> is perfectly valid! Then, since the function is called virtually:</p>
<pre><code>BaseClassPointerButItsActuallyADerivedClassPointer -&gt; function()
</code></pre>
<p><em>Calls the dervived function, virtually!</em></p>
<p>How the hell does this work?</p>
<h2>VTABLES</h2>
<p>It's not the type of the pointer that decides what function is called - it's the actual object. Each object has a table of function pointers. Therefore, <code>ObjectPointer-&gt;toString()</code> checks that objects vtable for a reference to a toString.</p>
<p>Your Shape object probably has these fields:</p>
<ul>
<li>Character pointer, name</li>
<li>Function pointer, draw</li>
</ul>
<p>The Shape base class probably defined <code>printName</code>. The compiler knows to call this function for any and all instances of a Shape. Therefore, our objects don't need a pointer to it. Meanwhile, <code>draw</code> is a <em>pure virtual function</em>. The base class provides no definition for it. Each Shape object has a pointer to its own version of the draw function - squares and circles will be drawn differently.</p>
<p>Let's be more specific here - since each Rectangle object will have the same vTable, they all actually have a pointer to the same vTable.</p>
<pre><code>
My Shapes Array
+------------+
| PtrToShape |     My Rectangle                                           
+------------+     +-------------+                                        
| PtrToShape | --&gt; | PtrToVTable | \
+------------+     +-------------+  \
| PtrToShape |     | PtrToName   |   \
+------------+     +-------------+    \    Rectangle vTable
| PtrToShape |                         &gt;-&gt; +--------------------+
+------------+                        /    | PtrToFunc: Draw    | --&gt; void func Draw(Rectangle* self){}
| PtrToShape |     My Rectangle 2    /     +--------------------+
+------------+     +-------------+  /      | PtrToFunc: GetArea |
| PtrToShape | --&gt; | PtrToVTable | /       +--------------------+
+------------+     +-------------+
                   | PtrToName   |
                   +-------------+
</code></pre>
<hr>
<p><a href="../../../">Index</a> &gt; <a href="./">Malware</a> &gt; Mon Mar 22 2021 20:00:00 GMT-0400 (Eastern Daylight Time):</p>

</article>
			
			<footer>
				<hr>
				<p>
					&copy; <a href="https://ewitherington.me">Ethan Witherington</a> 2022
				</p>
			</footer>
		</main>
	</body>

</html>