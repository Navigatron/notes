<!DOCTYPE html>
<html lang=" en-US">

	<head>
		<meta charset="UTF-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">

		
	<!-- MathJax disabled on this page -->

		


		<!--[if lt IE 9]>
			<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
		<![endif]-->
		
		<style>
			@import url('https://fonts.googleapis.com/css2?family=Arvo&family=Fira+Mono&family=Open+Sans&display=swap');
		</style>
		<link rel="stylesheet" href="/styles/index.css?v=1657689426781">

		<!-- Code Highlighting -->
		<link rel="stylesheet" href="https://raw.githubusercontent.com/PrismJS/prism-themes/master/themes/prism-one-light.css">
	</head>

	<body>
		<main>
			
			


<article>
	<p><a href="../../../">Index</a> &gt; <a href="./">Course</a> &gt; Wed Feb 24 2021 19:00:00 GMT-0500 (Eastern Standard Time):</p>
<h1>Wed Feb 24 2021 19:00:00 GMT-0500 (Eastern Standard Time):</h1>
<p>Quick recap - Malware uses crypto very differently from everyone else. Their keys will be found, so they try to use the fastest crypto available (XOR) to evade detection.</p>
<h2>Beyond XOR</h2>
<ul>
<li>ADD and SUB</li>
<li>ROL and ROR (Rotate left and right)</li>
<li>ROT (like rot13)</li>
<li>Multibyte
<ul>
<li>Using more than 1 byte for xoring</li>
</ul>
</li>
<li>Chained / Loopback
<ul>
<li>Encrypt(byte1) = key for byte 2</li>
<li>Encrypt(byte2) = key for byte 3</li>
</ul>
</li>
</ul>
<h2>Base64</h2>
<p>Base64 was made for transmitting email attachments. It converts binary data to a set of 64 printable ASCII characters, since email could originally only handle printable characters.</p>
<p>There are more than one sets of characters, but the most common is <code>[A-Za-z0-9+/]</code>, with the <code>=</code> character for padding. The mapping is as follows:</p>
<ul>
<li>0 → A</li>
<li>1 → B</li>
<li>...</li>
<li>24 → Y</li>
<li>25 → Z</li>
<li>26 → a</li>
<li>27 → b</li>
<li>...</li>
<li>60 → y</li>
<li>61 → z</li>
<li>62 → +</li>
<li>63 → /</li>
</ul>
<p>3 bytes of binary maps to 4 bytes of base64 encoding. 6 bits become 1 base64 character.</p>
<pre><code>data:   |   A     |   T     |   T     |
8bit:   |  0x41   |  0x54   |  0x54   | (hex)
binary: |010000|01|0101|0100|01|010100|
6bit:   |   16 |   21  |   17  |   20 | (decimal)
base64: |   Q  |   V   |   R   |   U  |
</code></pre>
<p>If there are any leftover bits, they are padded with zeros to make a new base64 character.</p>
<p>Standard practice is to pad with <code>=</code> such that the base64 text is a multiple of 4 in length, but this isn't <em>strictly</em> required.</p>
<h2>Malware with base64</h2>
<p>Malware can be sneaky - instead of the standard base64 dictionary, they may use a modified one:</p>
<pre><code>aABCDEFGHIJKLMNOPQRSTUVWXYZbcdefghijklmnopqrstuvwxyz+/
</code></pre>
<p>Moving the lowercase a to the front shifts all the other characters, meaning that a conventional de-encoding would yield a scrambled string.</p>
<h2>Why not AES?</h2>
<ul>
<li>Bringing a crypto library with you:
<ul>
<li>malware size is huge</li>
<li>easily detectable</li>
</ul>
</li>
<li>Linking on the host reduces portability</li>
</ul>
<p>Analysts will still see the decryption, and will find the key - so AES provides no benefits over something simple like XOR.</p>
<h2>Recognizing Static Patterns</h2>
<h3>Run Strings</h3>
<p>The <code>strings</code> command can reveal a lot about a binary. Libraries with embedded strings can be immediately recognized, like OpenSSL or AES.</p>
<h3>Find Crypto Constants</h3>
<p>Crypto algorithms use constants, or arrays of constants. If these are present in the binary, it likely uses those algorithms. There are tools to scan for these constants, like KANAL.</p>
<h3>Entropy Density</h3>
<p>The IDA Entropy plugin can scan for high-entropy strings. These could be crypto constants, or ciphertexts.</p>
<hr>
<p><a href="../../../">Index</a> &gt; <a href="./">Course</a> &gt; Wed Feb 24 2021 19:00:00 GMT-0500 (Eastern Standard Time):</p>

</article>
			
			<footer>
				<hr>
				<p>
					&copy; <a href="https://ewitherington.me">Ethan Witherington</a> 2022
				</p>
			</footer>
		</main>
	</body>

</html>